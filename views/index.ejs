<!DOCTYPE html>
<html>
  <meta charset="utf-8" />
  <title>App</title>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="//cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <!-- <link type="text/css" rel="stylesheet" href="/assets/css/common.css" /> -->
    <style>
      .container .header {
        width: 100%;
        height: 15vh;
        background: cadetblue;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .container .header h2 {
        color: white;
        font-size: 45px;
      }
      .container .body {
        height: 85vh;
        background: azure;
      }
      .input-link-crawl {
        padding-top: 20px;
        margin: 0 auto;
        width: fit-content;
      }
      .input-content {
        padding-top: 5px;
      }
      .input-content input[type='text'] {
        height: 30px;
        width: 40vh;
      }
      .btn-database {
        background-color: aqua;
      }
      .input-link-crawl button {
        border: 1px solid;
        height: 35px;
        margin-left: 15px;
        width: auto;
      }
      .log-screen {
        overflow: auto;
        height: 60vh;
        width: 80%;
        margin: 50px auto;
        background: darkslategrey;
      }
      .log-screen p:first-child {
        margin-top: 20px;
      }
      .log-screen p:last-child {
        margin-bottom: 20px;
      }
      .log-screen p {
        padding-left: 25px;
        margin: 0;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h2>
          CRAWL TOOL
        </h2>
      </div>
      <div class="body">
        <div class="input-link-crawl">
          <div class="option">
            <input type="checkbox" name="headless" />
            <label for="headless">Ẩn Browser</label>
          </div>
          <div class="input-content">
            <input
              type="text"
              name="link-crawl"
              value="http://truyenchon.com/"
              readonly="true"
              placeholder="điền link bạn muốn cào dữ liệu"
              required="true"
            />
            <button class="btn-crawl" action="start">START</button>
            <button class="btn-database">View Data Crawled</button>
          </div>
        </div>
        <div class="log-screen"></div>
      </div>
      <div class="footer"></div>
    </div>
    <script>
      $('.btn-crawl').on('click', function() {
        const action = $(this).attr('action');
        $.ajax({
          method: 'POST',
          url: 'http://localhost:3000/tool/start',
          data: {
            url: $('input[name="link-crawl"]').val(),
            headless: $('input[name="headless"]').is(':checked'),
            action: action,
          },
        });
        // if(action == 'stop') {
        //   $('.btn-crawl').text('START');
        //   $(this).attr('action','start');
        // }
        // else {
        //   $('.btn-crawl').text('STOP');
        //   $(this).attr('action','stop');
        // };
      });
      var ws = new WebSocket('ws://localhost:3001');
      ws.onopen = function() {
        ws.send('test connect');
      };
      ws.onmessage = async function(res) {
        $('.log-screen').append(`<p> - ${res.data}</p>`);
        await scrollDown();
      };
      const scrollDown = async () => {
        document.querySelector('.log-screen p:last-child')
          .scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'end' });
      }
    </script>
  </body>
</html>
